@using Application.DTOs.ProductDTOs
@model IEnumerable<ProductDto>

@{
    ViewData["Title"] = "Ürün Listesi";
    var index = 1;
}

<div class="product-page">

    <!-- Üst başlık -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <div class="d-flex align-items-center gap-2 mb-1">
                <div class="product-icon-wrap">
                    <i class="bi bi-box-seam"></i>
                </div>
                <h2 class="page-title mb-0">Ürün Listesi</h2>
            </div>
            <p class="text-muted mb-0">
                Sistemde tanımlı tüm ürünleri buradan yönetebilirsiniz.
            </p>
        </div>

        <div class="d-flex flex-wrap gap-2">
            <a asp-area="Admin" asp-controller="Product" asp-action="Create"
               class="btn btn-primary d-flex align-items-center gap-2">
                <i class="bi bi-plus-circle"></i>
                <span>Yeni Ürün</span>
            </a>

            <a asp-area="Admin" asp-controller="Product" asp-action="Trash"
               class="btn btn-outline-danger d-flex align-items-center gap-2">
                <i class="bi bi-trash3"></i>
                <span>Çöp Kutusu</span>
            </a>
        </div>
    </div>

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
    }

    <!-- Ürün tablosu -->
    <div class="card product-card shadow-sm">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table mb-0 product-table align-middle">
                    <thead>
                        <tr>
                            <th style="width:60px;">#</th>
                            <th>Ürün Adı</th>
                            <th style="width:120px;">Fiyat</th>
                            <th style="width:110px;">Stok</th>
                            <th style="width:110px;">Kategori Id</th>
                            <th style="width:110px;">Öne Çıkan</th>
                            <th style="width: 190px;" class="text-center">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (!Model.Any())
                        {
                            <tr>
                                <td colspan="7" class="text-center py-4 text-muted">
                                    Henüz ürün eklenmemiş.
                                </td>
                            </tr>
                        }
                        else
                        {
                            foreach (var item in Model)
                            {
                                <tr>
                                    <td class="text-muted">@index</td>
                                    <td>
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="dot-badge"></div>
                                            <span class="fw-semibold">@item.Name</span>
                                        </div>
                                    </td>
                                    <td>@item.Price.ToString("C")</td>
                                    <td>@item.Stock</td>
                                    <td>@item.CategoryId</td>
                                    <td>
                                        @if (item.IsFeatured)
                                        {
                                            <span class="badge bg-success-subtle text-success">
                                                <i class="bi bi-star-fill me-1"></i> Evet
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary-subtle text-secondary">
                                                Hayır
                                            </span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <div class="d-flex justify-content-center gap-1">

                                            <!-- Düzenle -->
                                            <a asp-area="Admin"
                                               asp-controller="Product"
                                               asp-action="Update"
                                               asp-route-id="@item.Id"
                                               class="btn btn-warning btn-sm"
                                               title="Düzenle">
                                                <i class="bi bi-pencil-square"></i>
                                            </a>

                                            <!-- Müşteri sayfasında gör (Detay) -->
                                            <a asp-area=""
                                               asp-controller="Product"
                                               asp-action="Detail"
                                               asp-route-id="@item.Id"
                                               asp-route-returnUrl="/Admin/Product/Index"
                                               target="_blank"
                                               class="btn btn-info btn-sm"
                                               title="Mağazada Gör">
                                                <i class="bi bi-box-arrow-up-right"></i>
                                            </a>


                                            <!-- Sil (POST) -->
                                            <form asp-area="Admin"
                                                  asp-controller="Product"
                                                  asp-action="Delete"
                                                  asp-route-id="@item.Id"
                                                  method="post"
                                                  class="d-inline"
                                                  onsubmit="return confirm('@item.Name ürününü silmek istediğinize emin misiniz?');">
                                                <button type="submit"
                                                        class="btn btn-danger btn-sm"
                                                        title="Sil">
                                                    <i class="bi bi-x-circle"></i>
                                                </button>
                                            </form>

                                        </div>
                                    </td>
                                </tr>
                                index++;
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <style>
        .product-page {
            background: transparent;
        }

        .page-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: #1f2937;
        }

        .product-icon-wrap {
            width: 40px;
            height: 40px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #eff6ff, #e0f2fe);
            color: #2563eb;
            font-size: 1.4rem;
        }

        .product-card {
            border-radius: 18px;
            border: none;
            overflow: hidden;
        }

        .product-table thead {
            background: #f9fafb;
        }

            .product-table thead th {
                font-size: .78rem;
                text-transform: uppercase;
                letter-spacing: .06em;
                color: #6b7280;
                border-bottom: 1px solid #e5e7eb;
            }

        .product-table tbody tr {
            transition: background-color 0.18s ease, transform 0.12s ease;
        }

            .product-table tbody tr:hover {
                background: #f5f7ff;
                transform: translateX(2px);
            }

        .product-table td {
            border-top: 1px solid #f1f5f9;
            font-size: .95rem;
        }

        .dot-badge {
            width: 8px;
            height: 8px;
            border-radius: 999px;
            background: #2563eb;
        }
    </style>
}
